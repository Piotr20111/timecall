<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-signin-client_id" content="630173406824-ada5j713qsm99do8e98fvbiiq61j59dj.apps.googleusercontent.com">
    <title>Timer Hub - ZarzƒÖdzanie czasem spotka≈Ñ i film√≥w</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen" style="display: none;">
        <div class="login-container">
            <div class="login-header">
                <i class="fas fa-clock"></i>
                <h1>Timer Hub</h1>
                <p>Zaloguj siƒô aby kontynuowaƒá</p>
            </div>
            
            <div id="googleSignInButton" style="display: flex; justify-content: center; margin: 2rem 0;">
                <!-- Google button will be rendered here -->
            </div>
            
            <div class="login-footer">
                <p>ZarzƒÖdzaj swoim czasem efektywnie</p>
                <p style="font-size: 0.8rem; margin-top: 0.5rem; opacity: 0.7;">
                    ¬© 2025 Timer Hub by Piotr20111
                </p>
            </div>
        </div>
    </div>

    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loader">
            <div class="loader-circle"></div>
            <div class="loader-circle"></div>
            <div class="loader-circle"></div>
        </div>
        <h2>Timer Hub</h2>
    </div>

    <!-- Search Overlay -->
    <div id="searchOverlay" class="search-overlay">
        <div class="search-container">
            <div class="search-header">
                <i class="fas fa-search"></i>
                <input type="text" id="universalSearch" placeholder="Szukaj spotka≈Ñ, film√≥w, kana≈Ç√≥w..." autocomplete="off">
                <button class="search-close" onclick="window.app.closeSearch()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="search-status" id="searchStatus" style="display: none;">
                <div class="search-spinner"></div>
                <span>Wyszukiwanie TimerHub...</span>
            </div>
            <div class="search-results" id="searchResults"></div>
        </div>
    </div>

    <!-- AI Assistant -->
    <div id="aiAssistant" class="ai-assistant">
        <div class="ai-header">
            <i class="fas fa-robot"></i>
            <span>Asystent TimerHub</span>
            <button class="ai-close" onclick="window.app.closeAIAssistant()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="ai-messages" id="aiMessages"></div>
        <div class="ai-input-container">
            <input type="text" id="aiInput" placeholder="Zapytaj o cokolwiek..." autocomplete="off">
            <button onclick="window.app.sendAIMessage()">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <!-- Avatar Selection Modal -->
    <div id="avatarModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-circle"></i> Wybierz avatar</h3>
                <button class="modal-close" onclick="window.app.closeAvatarModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="avatar-grid">
                    <div class="avatar-option" onclick="window.app.selectAvatar('astronaut')">
                        <div class="avatar-preview">üßë‚ÄçüöÄ</div>
                        <span>Astronauta</span>
                    </div>
                    <div class="avatar-option" onclick="window.app.selectAvatar('ninja')">
                        <div class="avatar-preview">ü•∑</div>
                        <span>Ninja</span>
                    </div>
                    <div class="avatar-option" onclick="window.app.selectAvatar('wizard')">
                        <div class="avatar-preview">üßô‚Äç‚ôÇÔ∏è</div>
                        <span>Czarodziej</span>
                    </div>
                    <div class="avatar-option" onclick="window.app.selectAvatar('robot')">
                        <div class="avatar-preview">ü§ñ</div>
                        <span>Robot</span>
                    </div>
                    <div class="avatar-option" onclick="window.app.selectAvatar('alien')">
                        <div class="avatar-preview">üëΩ</div>
                        <span>Kosmita</span>
                    </div>
                    <div class="avatar-option" onclick="window.app.selectAvatar('superhero')">
                        <div class="avatar-preview">ü¶∏</div>
                        <span>Superbohater</span>
                    </div>
                    <div class="avatar-option" onclick="window.app.selectAvatar('pirate')">
                        <div class="avatar-preview">üè¥‚Äç‚ò†Ô∏è</div>
                        <span>Pirat</span>
                    </div>
                    <div class="avatar-option" onclick="window.app.selectAvatar('unicorn')">
                        <div class="avatar-preview">ü¶Ñ</div>
                        <span>Jednoro≈ºec</span>
                    </div>
                    <div class="avatar-option" onclick="window.app.selectAvatar('dragon')">
                        <div class="avatar-preview">üêâ</div>
                        <span>Smok</span>
                    </div>
                    <div class="avatar-option" onclick="window.app.selectAvatar('phoenix')">
                        <div class="avatar-preview">üî•</div>
                        <span>Feniks</span>
                    </div>
                    <div class="avatar-option" onclick="window.app.selectAvatar('owl')">
                        <div class="avatar-preview">ü¶â</div>
                        <span>Sowa</span>
                    </div>
                    <div class="avatar-option" onclick="window.app.selectAvatar('fox')">
                        <div class="avatar-preview">ü¶ä</div>
                        <span>Lis</span>
                    </div>
                    <div class="avatar-option" onclick="window.app.selectAvatar('wolf')">
                        <div class="avatar-preview">üê∫</div>
                        <span>Wilk</span>
                    </div>
                    <div class="avatar-option" onclick="window.app.selectAvatar('lion')">
                        <div class="avatar-preview">ü¶Å</div>
                        <span>Lew</span>
                    </div>
                    <div class="avatar-option" onclick="window.app.selectAvatar('crown')">
                        <div class="avatar-preview">üëë</div>
                        <span>Korona</span>
                    </div>
                </div>
                <div class="avatar-actions">
                    <button class="avatar-reset-btn" onclick="window.app.resetToGoogleAvatar()">
                        <i class="fas fa-undo"></i> Przywr√≥ƒá zdjƒôcie Google
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notes Modal -->
    <div id="notesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-sticky-note"></i> <span id="notesTitle">Notatki</span></h3>
                <button class="modal-close" onclick="window.app.closeNotesModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="notes-tabs">
                    <button class="note-tab active" onclick="window.app.switchNoteTab('before')">Przed spotkaniem</button>
                    <button class="note-tab" onclick="window.app.switchNoteTab('during')">Podczas spotkania</button>
                    <button class="note-tab" onclick="window.app.switchNoteTab('after')">Po spotkaniu</button>
                </div>
                <div class="notes-content">
                    <textarea id="notesTextarea" placeholder="Wprowad≈∫ notatki..."></textarea>
                </div>
                <div class="notes-actions">
                    <button class="notes-save-btn" onclick="window.app.saveNotes()">
                        <i class="fas fa-save"></i> Zapisz
                    </button>
                    <button class="notes-export-btn" onclick="window.app.exportNotes()">
                        <i class="fas fa-download"></i> Eksportuj
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Message Edit Modal -->
    <div id="editMessageModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Edytuj wiadomo≈õƒá</h3>
                <button class="modal-close" onclick="window.app.closeEditModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <textarea id="editMessageTextarea" placeholder="Edytuj wiadomo≈õƒá..." style="width: 100%; min-height: 100px;"></textarea>
                <div class="edit-actions" style="margin-top: 1rem; display: flex; gap: 1rem;">
                    <button class="save-edit-btn" onclick="window.app.saveEditedMessage()">
                        <i class="fas fa-save"></i> Zapisz
                    </button>
                    <button class="cancel-edit-btn" onclick="window.app.closeEditModal()">
                        <i class="fas fa-times"></i> Anuluj
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Calendar Integration Modal -->
    <div id="calendarModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3><i class="fas fa-calendar-alt"></i> Kalendarz</h3>
                <button class="modal-close" onclick="window.app.closeCalendarModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="calendar-view">
                    <div class="calendar-header">
                        <button onclick="window.app.previousMonth()"><i class="fas fa-chevron-left"></i></button>
                        <h4 id="calendarMonthYear"></h4>
                        <button onclick="window.app.nextMonth()"><i class="fas fa-chevron-right"></i></button>
                    </div>
                    <div class="calendar-weekdays">
                        <div>Pon</div>
                        <div>Wt</div>
                        <div>≈ör</div>
                        <div>Czw</div>
                        <div>Pt</div>
                        <div>Sob</div>
                        <div>Nd</div>
                    </div>
                    <div id="calendarDays" class="calendar-days"></div>
                </div>
                <div class="calendar-events">
                    <h4>Wydarzenia w wybranym dniu</h4>
                    <div id="dayEvents" class="day-events-list">
                        <p class="empty-state">Wybierz dzie≈Ñ aby zobaczyƒá wydarzenia</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Stats Modal -->
    <div id="statsModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h3><i class="fas fa-chart-line"></i> Szczeg√≥≈Çowe statystyki</h3>
                <button class="modal-close" onclick="window.app.closeStatsModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="stats-tabs">
                    <button class="stat-tab active" onclick="window.app.showStatTab('overview')">Podsumowanie</button>
                    <button class="stat-tab" onclick="window.app.showStatTab('meetings')">Spotkania</button>
                    <button class="stat-tab" onclick="window.app.showStatTab('youtube')">YouTube</button>
                    <button class="stat-tab" onclick="window.app.showStatTab('productivity')">Produktywno≈õƒá</button>
                </div>
                <div id="statsContent" class="stats-content"></div>
            </div>
        </div>
    </div>

    <!-- Playlist View Modal -->
    <div id="playlistViewModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3><i class="fas fa-list"></i> <span id="playlistViewTitle">Playlista</span></h3>
                <button class="modal-close" onclick="window.app.closePlaylistView()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="playlist-actions">
                    <button class="add-video-btn" onclick="window.app.addVideoToPlaylist()">
                        <i class="fas fa-plus"></i> Dodaj film
                    </button>
                    <button class="play-all-btn" onclick="window.app.playAllVideos()">
                        <i class="fas fa-play"></i> Odtw√≥rz wszystkie
                    </button>
                </div>
                <div id="playlistVideos" class="playlist-videos-list"></div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container" style="display: none;">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1 class="logo">
                    <i class="fas fa-clock"></i>
                    Timer Hub
                </h1>
                <div class="header-actions">
                    <button class="search-btn" onclick="window.app.openSearch()">
                        <i class="fas fa-search"></i>
                    </button>
                    <button class="ai-btn" onclick="window.app.openAIAssistant()">
                        <i class="fas fa-robot"></i>
                    </button>
                    <div class="user-info" id="userInfo">
                        <img id="userAvatar" src="" alt="Avatar" class="user-avatar" onerror="this.src='https://ui-avatars.com/api/?name=User&background=6366f1&color=fff'" onclick="window.app.openAvatarModal()">
                        <span id="userName"></span>
                    </div>
                    <button class="chat-toggle-btn" onclick="window.app.toggleChat()">
                        <i class="fas fa-comments"></i>
                        <span class="chat-badge" id="chatBadge" style="display: none;">0</span>
                    </button>
                    <button class="settings-btn" onclick="window.app.toggleSettings()">
                        <i class="fas fa-cog"></i>
                    </button>
                    <button class="theme-toggle" id="themeToggle" onclick="window.app.toggleTheme()">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button class="logout-btn" onclick="window.app.logout()">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                    <div class="time-display" id="currentTime"></div>
                </div>
            </div>
        </header>

        <!-- Settings Panel -->
        <div id="settingsPanel" class="settings-panel">
            <div class="settings-header">
                <h3><i class="fas fa-cog"></i> Ustawienia</h3>
                <button class="settings-close" onclick="window.app.toggleSettings()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="settings-content">
                <!-- Notifications Settings -->
                <div class="settings-section">
                    <h4><i class="fas fa-bell"></i> Powiadomienia</h4>
                    <div class="settings-item">
                        <label>
                            <input type="checkbox" id="enableNotifications" checked onchange="window.app.updateNotificationSettings()">
                            <span>W≈ÇƒÖcz powiadomienia</span>
                        </label>
                    </div>
                    <div class="settings-item">
                        <label>
                            <input type="checkbox" id="enableChatNotifications" checked onchange="window.app.updateNotificationSettings()">
                            <span>Powiadomienia czatu</span>
                        </label>
                    </div>
                    <div class="settings-item">
                        <label>
                            <input type="checkbox" id="enableTimerNotifications" checked onchange="window.app.updateNotificationSettings()">
                            <span>Powiadomienia timer√≥w</span>
                        </label>
                    </div>
                    <div class="settings-item">
                        <label>
                            <input type="checkbox" id="enablePushNotifications" onchange="window.app.togglePushNotifications()">
                            <span>Powiadomienia push (na telefon)</span>
                        </label>
                    </div>
                    <div class="settings-item">
                        <label>D≈∫wiƒôk powiadomie≈Ñ:</label>
                        <select id="notificationSound" onchange="window.app.changeNotificationSound(this.value)">
                            <option value="default">Domy≈õlny</option>
                            <option value="bell">Dzwonek</option>
                            <option value="chime">Kuranty</option>
                            <option value="pop">Pop</option>
                            <option value="none">Brak</option>
                        </select>
                    </div>
                    <div class="settings-item">
                        <label>Wycisz powiadomienia na:</label>
                        <select id="muteNotifications" onchange="window.app.muteNotifications(this.value)">
                            <option value="0">Nie wyciszaj</option>
                            <option value="30">30 minut</option>
                            <option value="60">1 godzinƒô</option>
                            <option value="120">2 godziny</option>
                            <option value="480">8 godzin</option>
                            <option value="-1">Na zawsze</option>
                        </select>
                    </div>
                </div>

                <!-- Appearance Settings -->
                <div class="settings-section">
                    <h4><i class="fas fa-palette"></i> WyglƒÖd i stylizacja</h4>
                    <div class="settings-item">
                        <label>Motyw kolorystyczny:</label>
                        <select id="colorTheme" onchange="window.app.changeColorTheme(this.value)">
                            <option value="default">Domy≈õlny (Fioletowy)</option>
                            <option value="blue">Niebieski</option>
                            <option value="green">Zielony</option>
                            <option value="red">Czerwony</option>
                            <option value="orange">Pomara≈Ñczowy</option>
                            <option value="pink">R√≥≈ºowy</option>
                            <option value="teal">Turkusowy</option>
                            <option value="gradient">Gradientowy</option>
                            <option value="dark-pro">Dark Pro</option>
                        </select>
                    </div>
                    <div class="settings-item">
                        <label>Rozmiar czcionki:</label>
                        <select id="fontSize" onchange="window.app.changeFontSize(this.value)">
                            <option value="small">Ma≈Ça</option>
                            <option value="normal">Normalna</option>
                            <option value="large">Du≈ºa</option>
                            <option value="xlarge">Bardzo du≈ºa</option>
                        </select>
                    </div>
                    <div class="settings-item">
                        <label>Styl kart:</label>
                        <select id="cardStyle" onchange="window.app.changeCardStyle(this.value)">
                            <option value="default">Domy≈õlny</option>
                            <option value="flat">P≈Çaski</option>
                            <option value="neumorphic">Neumorficzny</option>
                            <option value="glassmorphic">Glassmorficzny</option>
                        </select>
                    </div>
                    <div class="settings-item">
                        <label>
                            <input type="checkbox" id="enableCompactMode" onchange="window.app.toggleCompactMode()">
                            <span>Tryb kompaktowy</span>
                        </label>
                    </div>
                    <div class="settings-item">
                        <label>
                            <input type="checkbox" id="enableDarkModeSched" onchange="window.app.toggleDarkModeSchedule()">
                            <span>Automatyczny tryb ciemny (19:00-7:00)</span>
                        </label>
                    </div>
                </div>

                <!-- Region Settings -->
                <div class="settings-section">
                    <h4><i class="fas fa-globe"></i> Region i jƒôzyk</h4>
                    <div class="settings-item">
                        <label>Region:</label>
                        <select id="regionSelect" onchange="window.app.changeRegion(this.value)">
                            <option value="pl-PL">Polska</option>
                            <option value="en-US">United States</option>
                            <option value="en-GB">United Kingdom</option>
                            <option value="de-DE">Deutschland</option>
                            <option value="fr-FR">France</option>
                            <option value="es-ES">Espa√±a</option>
                            <option value="it-IT">Italia</option>
                            <option value="pt-BR">Brasil</option>
                            <option value="ru-RU">–†–æ—Å—Å–∏—è</option>
                            <option value="ja-JP">Êó•Êú¨</option>
                            <option value="zh-CN">‰∏≠ÂõΩ</option>
                            <option value="ko-KR">ÌïúÍµ≠</option>
                            <option value="nl-NL">Nederland</option>
                            <option value="sv-SE">Sverige</option>
                            <option value="cs-CZ">ƒåesk√° republika</option>
                            <option value="uk-UA">–£–∫—Ä–∞—ó–Ω–∞</option>
                        </select>
                    </div>
                    <div class="settings-item">
                        <label>Format czasu:</label>
                        <select id="timeFormat" onchange="window.app.changeTimeFormat(this.value)">
                            <option value="24h">24-godzinny</option>
                            <option value="12h">12-godzinny (AM/PM)</option>
                        </select>
                    </div>
                </div>

                <!-- Productivity Settings -->
                <div class="settings-section">
                    <h4><i class="fas fa-tasks"></i> Produktywno≈õƒá</h4>
                    <div class="settings-item">
                        <label>
                            <input type="checkbox" id="enablePomodoro" onchange="window.app.togglePomodoro()">
                            <span>W≈ÇƒÖcz tryb Pomodoro</span>
                        </label>
                    </div>
                    <div class="settings-item">
                        <label>Czas pracy (minuty):</label>
                        <input type="number" id="pomodoroWork" value="25" min="1" max="60" onchange="window.app.updatePomodoroSettings()">
                    </div>
                    <div class="settings-item">
                        <label>Czas przerwy (minuty):</label>
                        <input type="number" id="pomodoroBreak" value="5" min="1" max="30" onchange="window.app.updatePomodoroSettings()">
                    </div>
                    <div class="settings-item">
                        <label>
                            <input type="checkbox" id="enableAutoBreak" onchange="window.app.toggleAutoBreak()">
                            <span>Automatyczne przerwy co 2 godziny</span>
                        </label>
                    </div>
                </div>

                <!-- Device Settings -->
                <div class="settings-section">
                    <h4><i class="fas fa-desktop"></i> Przystosowanie do urzƒÖdzenia</h4>
                    <div class="settings-item">
                        <label>Optymalizacja dla:</label>
                        <select id="deviceOptimization" onchange="window.app.changeDeviceOptimization(this.value)">
                            <option value="auto">Automatyczna</option>
                            <option value="desktop">Komputer</option>
                            <option value="mobile">UrzƒÖdzenia mobilne</option>
                        </select>
                    </div>
                    <div class="settings-item">
                        <label>
                            <input type="checkbox" id="enableAnimations" checked onchange="window.app.toggleAnimations()">
                            <span>W≈ÇƒÖcz animacje</span>
                        </label>
                    </div>
                    <div class="settings-item">
                        <label>
                            <input type="checkbox" id="reducedMotion" onchange="window.app.toggleReducedMotion()">
                            <span>Ograniczone animacje</span>
                        </label>
                    </div>
                </div>

                <!-- Privacy Settings -->
                <div class="settings-section">
                    <h4><i class="fas fa-shield-alt"></i> Prywatno≈õƒá</h4>
                    <div class="settings-item">
                        <label>
                            <input type="checkbox" id="showOnlineStatus" checked onchange="window.app.updatePrivacySettings()">
                            <span>Poka≈º status online</span>
                        </label>
                    </div>
                    <div class="settings-item">
                        <label>
                            <input type="checkbox" id="showReadReceipts" checked onchange="window.app.updatePrivacySettings()">
                            <span>Poka≈º potwierdzenia przeczytania</span>
                        </label>
                    </div>
                    <div class="settings-item">
                        <label>
                            <input type="checkbox" id="enableAnalytics" checked onchange="window.app.toggleAnalytics()">
                            <span>Zbieraj dane analityczne</span>
                        </label>
                    </div>
                </div>

                <!-- Data Management -->
                <div class="settings-section">
                    <h4><i class="fas fa-database"></i> ZarzƒÖdzanie danymi</h4>
                    <div class="settings-item">
                        <button class="settings-button" onclick="window.app.exportData()">
                            <i class="fas fa-download"></i> Eksportuj dane
                        </button>
                    </div>
                    <div class="settings-item">
                        <button class="settings-button" onclick="window.app.importData()">
                            <i class="fas fa-upload"></i> Importuj dane
                        </button>
                    </div>
                    <div class="settings-item">
                        <button class="settings-button" onclick="window.app.syncWithCloud()">
                            <i class="fas fa-cloud-upload-alt"></i> Synchronizuj z chmurƒÖ
                        </button>
                    </div>
                    <div class="settings-item">
                        <button class="settings-button danger" onclick="window.app.clearAllData()">
                            <i class="fas fa-trash"></i> Wyczy≈õƒá wszystkie dane
                        </button>
                    </div>
                </div>

                <!-- Advanced Settings -->
                <div class="settings-section">
                    <h4><i class="fas fa-tools"></i> Zaawansowane</h4>
                    <div class="settings-item">
                        <label>
                            <input type="checkbox" id="enableDebugMode" onchange="window.app.toggleDebugMode()">
                            <span>Tryb debugowania</span>
                        </label>
                    </div>
                    <div class="settings-item">
                        <label>
                            <input type="checkbox" id="enableKeyboardShortcuts" checked onchange="window.app.toggleKeyboardShortcuts()">
                            <span>Skr√≥ty klawiszowe</span>
                        </label>
                    </div>
                    <div class="settings-item">
                        <button class="settings-button" onclick="window.app.showKeyboardShortcuts()">
                            <i class="fas fa-keyboard"></i> Poka≈º skr√≥ty klawiszowe
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Global Chat -->
        <div id="globalChat" class="global-chat">
            <div class="chat-header">
                <h3><i class="fas fa-comments"></i> Czat globalny</h3>
                <div class="chat-header-actions">
                    <span class="online-users">
                        <i class="fas fa-users"></i>
                        <span id="onlineCount">0</span> online
                    </span>
                    <button class="chat-close" onclick="window.app.toggleChat()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <!-- Chat Tabs -->
            <div class="chat-tabs">
                <button class="chat-tab active" onclick="window.app.switchChatTab('global')">
                    <i class="fas fa-globe"></i> Globalny
                </button>
                <button class="chat-tab" onclick="window.app.switchChatTab('private')">
                    <i class="fas fa-user"></i> Prywatne
                    <span class="pm-badge" id="pmBadge" style="display: none;">0</span>
                </button>
            </div>
            
            <!-- Global Chat Messages -->
            <div id="globalChatContent" class="chat-content active">
                <div class="chat-messages" id="chatMessages">
                    <div class="chat-welcome">
                        <i class="fas fa-comments"></i>
                        <p>Witaj w czacie globalnym!</p>
                        <p class="text-muted">Rozpocznij rozmowƒô z innymi u≈ºytkownikami</p>
                    </div>
                </div>
                <div class="chat-typing" id="chatTyping" style="display: none;">
                    <span class="typing-indicator">
                        <span></span>
                        <span></span>
                        <span></span>
                    </span>
                    <span id="typingUsers"></span>
                </div>
                <form class="chat-input-form" onsubmit="window.app.sendMessage(event)">
                    <button type="button" class="chat-emoji-btn" onclick="window.app.toggleEmojiPicker()">
                        <i class="far fa-smile"></i>
                    </button>
                    <input 
                        type="text" 
                        id="chatInput" 
                        class="chat-input" 
                        placeholder="Napisz wiadomo≈õƒá..."
                        maxlength="500"
                        autocomplete="off"
                        oninput="window.app.handleChatTyping()"
                    >
                    <button type="submit" class="chat-send">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </form>
                <div class="emoji-picker" id="emojiPicker" style="display: none;">
                    <div class="emoji-grid">
                        <span onclick="window.app.insertEmoji('üòÄ')">üòÄ</span>
                        <span onclick="window.app.insertEmoji('üòÇ')">üòÇ</span>
                        <span onclick="window.app.insertEmoji('üòç')">üòç</span>
                        <span onclick="window.app.insertEmoji('ü§î')">ü§î</span>
                        <span onclick="window.app.insertEmoji('üòé')">üòé</span>
                        <span onclick="window.app.insertEmoji('üò¢')">üò¢</span>
                        <span onclick="window.app.insertEmoji('üò°')">üò°</span>
                        <span onclick="window.app.insertEmoji('üëç')">üëç</span>
                        <span onclick="window.app.insertEmoji('üëé')">üëé</span>
                        <span onclick="window.app.insertEmoji('‚ù§Ô∏è')">‚ù§Ô∏è</span>
                        <span onclick="window.app.insertEmoji('üéâ')">üéâ</span>
                        <span onclick="window.app.insertEmoji('üî•')">üî•</span>
                    </div>
                </div>
            </div>
            
            <!-- Private Messages -->
            <div id="privateChatContent" class="chat-content">
                <div class="private-users-container">
                    <div class="private-users-header">
                        <h4>Dostƒôpni u≈ºytkownicy</h4>
                        <button class="refresh-users-btn" onclick="window.app.refreshUsersList()">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                    <div class="private-users-search">
                        <input type="text" id="privateUsersSearch" placeholder="Szukaj u≈ºytkownika..." oninput="window.app.filterPrivateUsers()">
                    </div>
                    <div class="private-users-list" id="privateUsersList">
                        <p class="empty-state">≈Åadowanie u≈ºytkownik√≥w...</p>
                    </div>
                </div>
                <div class="private-chat-window" id="privateChatWindow" style="display: none;">
                    <div class="private-chat-header">
                        <button class="back-to-users" onclick="window.app.backToUsersList()">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <div class="private-chat-user-info">
                            <img id="privateChatAvatar" src="" alt="">
                            <span id="privateChatUsername"></span>
                        </div>
                    </div>
                    <div class="chat-messages" id="privateMessages"></div>
                    <form class="chat-input-form" onsubmit="window.app.sendPrivateMessage(event)">
                        <input 
                            type="text" 
                            id="privateChatInput" 
                            class="chat-input" 
                            placeholder="Napisz prywatnƒÖ wiadomo≈õƒá..."
                            maxlength="500"
                            autocomplete="off"
                        >
                        <button type="submit" class="chat-send">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Message Context Menu -->
        <div id="messageContextMenu" class="message-context-menu">
            <button id="copyMessageBtn" onclick="window.app.copyMessageFromMenu()">
                <i class="fas fa-copy"></i> Kopiuj
            </button>
            <button id="replyMessageBtn" onclick="window.app.replyToMessage()">
                <i class="fas fa-reply"></i> Odpowiedz
            </button>
            <button id="editMessageBtn" onclick="window.app.editMessage()" style="display: none;">
                <i class="fas fa-edit"></i> Edytuj
            </button>
            <button id="deleteMessageBtn" onclick="window.app.deleteMessageFromMenu()" style="display: none;">
                <i class="fas fa-trash"></i> Usu≈Ñ
            </button>
        </div>

        <!-- Main Menu -->
        <div id="mainMenu" class="main-menu">
            <div class="welcome-section">
                <h2>Witaj, <span id="welcomeName"></span>!</h2>
                <p>ZarzƒÖdzaj swoim czasem podczas spotka≈Ñ i oglƒÖdania film√≥w</p>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions">
                <button class="quick-action-btn" onclick="window.app.startQuickTimer()">
                    <i class="fas fa-stopwatch"></i>
                    <span>Szybki timer</span>
                </button>
                <button class="quick-action-btn" onclick="window.app.startPomodoro()">
                    <i class="fas fa-seedling"></i>
                    <span>Pomodoro</span>
                </button>
                <button class="quick-action-btn" onclick="window.app.showCalendarIntegration()">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Kalendarz</span>
                </button>
                <button class="quick-action-btn" onclick="window.app.showStats()">
                    <i class="fas fa-chart-line"></i>
                    <span>Statystyki</span>
                </button>
            </div>
            
            <div class="menu-grid">
                <div class="menu-card teams-card" onclick="window.app.showTeamsMode()">
                    <div class="card-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <h3>Microsoft Teams</h3>
                    <p>ZarzƒÖdzaj spotkaniami i ustaw przypomnienia</p>
                    <div class="card-footer">
                        <span class="card-action">Rozpocznij <i class="fas fa-arrow-right"></i></span>
                    </div>
                </div>

                <div class="menu-card youtube-card" onclick="window.app.showYouTubeMode()">
                    <div class="card-icon">
                        <i class="fab fa-youtube"></i>
                    </div>
                    <h3>YouTube</h3>
                    <p>Zaplanuj oglƒÖdanie i zarzƒÖdzaj kana≈Çami</p>
                    <div class="card-footer">
                        <span class="card-action">Rozpocznij <i class="fas fa-arrow-right"></i></span>
                    </div>
                </div>
            </div>

            <div class="stats-section">
                <div class="stat-card">
                    <i class="fas fa-history"></i>
                    <div class="stat-content">
                        <span class="stat-value" id="totalMeetings">0</span>
                        <span class="stat-label">Spotka≈Ñ dzisiaj</span>
                    </div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-play-circle"></i>
                    <div class="stat-content">
                        <span class="stat-value" id="totalVideos">0</span>
                        <span class="stat-label">Film√≥w obejrzanych</span>
                    </div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-star"></i>
                    <div class="stat-content">
                        <span class="stat-value" id="favoriteChannels">0</span>
                        <span class="stat-label">Ulubionych kana≈Ç√≥w</span>
                    </div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-fire"></i>
                    <div class="stat-content">
                        <span class="stat-value" id="streakDays">0</span>
                        <span class="stat-label">Dni z rzƒôdu</span>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="recent-activity">
                <h3><i class="fas fa-clock"></i> Ostatnia aktywno≈õƒá</h3>
                <div id="recentActivityList" class="activity-list">
                    <p class="empty-state">Brak ostatniej aktywno≈õci</p>
                </div>
            </div>
        </div>

        <!-- Teams Mode -->
        <div id="teamsMode" class="mode-container" style="display: none;">
            <div class="mode-header">
                <button class="back-button" onclick="window.app.showMainMenu()">
                    <i class="fas fa-arrow-left"></i> Powr√≥t
                </button>
                <h2>
                    <i class="fas fa-users"></i>
                    Microsoft Teams
                </h2>
            </div>

            <div class="teams-tabs">
                <button class="tab active" onclick="window.app.showTeamsTab('new', event)">
                    <i class="fas fa-plus"></i> Nowe spotkanie
                </button>
                <button class="tab" onclick="window.app.showTeamsTab('upcoming', event)">
                    <i class="fas fa-calendar"></i> NadchodzƒÖce
                    <span class="tab-badge" id="upcomingBadge" style="display: none;">0</span>
                </button>
                <button class="tab" onclick="window.app.showTeamsTab('favorites', event)">
                    <i class="fas fa-star"></i> Ulubione
                </button>
                <button class="tab" onclick="window.app.showTeamsTab('history', event)">
                    <i class="fas fa-history"></i> Historia
                </button>
                <button class="tab" onclick="window.app.showTeamsTab('tags', event)">
                    <i class="fas fa-tags"></i> Tagi
                </button>
            </div>

            <!-- New Meeting Tab -->
            <div id="newTab" class="tab-content active">
                <div class="input-section glass-card">
                    <h3>Nowe spotkanie</h3>
                    <form id="teamsForm" onsubmit="window.app.handleTeamsSubmit(event)">
                        <div class="form-group">
                            <label for="meetingTitle">
                                <i class="fas fa-heading"></i> Tytu≈Ç spotkania
                            </label>
                            <input type="text" id="meetingTitle" placeholder="Np. Spotkanie zespo≈Çu" required>
                        </div>

                        <div class="form-group">
                            <label for="meetingLink">
                                <i class="fas fa-link"></i> Link do spotkania
                            </label>
                            <input type="url" id="meetingLink" placeholder="https://teams.microsoft.com/..." required>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="meetingDate">
                                    <i class="fas fa-calendar"></i> Data
                                </label>
                                <input type="date" id="meetingDate" required>
                            </div>
                            <div class="form-group">
                                <label for="meetingTime">
                                    <i class="fas fa-clock"></i> Godzina
                                </label>
                                <input type="time" id="meetingTime" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="meetingDuration">
                                <i class="fas fa-hourglass"></i> Czas trwania (minuty)
                            </label>
                            <input type="number" id="meetingDuration" value="60" min="1" required>
                        </div>

                        <div class="form-group">
                            <label for="meetingTags">
                                <i class="fas fa-tags"></i> Tagi (oddzielone przecinkami)
                            </label>
                            <input type="text" id="meetingTags" placeholder="praca, projekt, wa≈ºne">
                        </div>

                        <div class="form-group">
                            <label for="meetingReminders">
                                <i class="fas fa-bell"></i> Przypomnienia
                            </label>
                            <div class="reminder-options">
                                <label>
                                    <input type="checkbox" name="reminders" value="60" checked>
                                    <span>1 godzina przed</span>
                                </label>
                                <label>
                                    <input type="checkbox" name="reminders" value="30" checked>
                                    <span>30 minut przed</span>
                                </label>
                                <label>
                                    <input type="checkbox" name="reminders" value="15" checked>
                                    <span>15 minut przed</span>
                                </label>
                                <label>
                                    <input type="checkbox" name="reminders" value="5">
                                    <span>5 minut przed</span>
                                </label>
                            </div>
                        </div>

                        <div class="form-group checkbox-group">
                            <label>
                                <input type="checkbox" id="autoOpenTeams" checked>
                                <span>Otw√≥rz Teams automatycznie 2 minuty przed spotkaniem</span>
                            </label>
                        </div>

                        <div class="form-group checkbox-group">
                            <label>
                                <input type="checkbox" id="addToFavorites">
                                <span>Dodaj do ulubionych</span>
                            </label>
                        </div>

                        <button type="submit" class="submit-button">
                            <i class="fas fa-play"></i> Rozpocznij odliczanie
                        </button>
                    </form>
                </div>
            </div>

            <!-- Upcoming Tab -->
            <div id="upcomingTab" class="tab-content" style="display: none;">
                <div class="meetings-list glass-card">
                    <div class="meetings-header">
                        <h3>NadchodzƒÖce spotkania</h3>
                        <button class="add-meeting-btn gradient-btn" onclick="window.app.showAddUpcomingMeeting()">
                            <i class="fas fa-plus-circle"></i> Dodaj spotkanie
                        </button>
                    </div>
                    <div class="meetings-filters">
                        <input type="text" id="meetingsSearch" placeholder="Szukaj spotka≈Ñ..." oninput="window.app.filterMeetings()">
                        <select id="meetingsFilter" onchange="window.app.filterMeetings()">
                            <option value="all">Wszystkie</option>
                            <option value="today">Dzisiaj</option>
                            <option value="week">Ten tydzie≈Ñ</option>
                            <option value="month">Ten miesiƒÖc</option>
                        </select>
                    </div>
                    <div id="upcomingMeetings" class="meetings-container">
                        <p class="empty-state">Brak zaplanowanych spotka≈Ñ</p>
                    </div>
                </div>
            </div>

            <!-- Favorites Tab -->
            <div id="favoritesTab" class="tab-content" style="display: none;">
                <div class="meetings-list glass-card">
                    <h3>Ulubione spotkania</h3>
                    <div id="favoriteMeetings" class="meetings-container">
                        <p class="empty-state">Brak ulubionych spotka≈Ñ</p>
                    </div>
                </div>
            </div>

            <!-- History Tab -->
            <div id="historyTab" class="tab-content" style="display: none;">
                <div class="meetings-list glass-card">
                    <div class="history-header">
                        <h3>Historia spotka≈Ñ</h3>
                        <button class="clear-history-btn" onclick="window.app.clearMeetingsHistory()">
                            <i class="fas fa-trash"></i> Wyczy≈õƒá
                        </button>
                    </div>
                    <div id="meetingsHistory" class="meetings-container">
                        <p class="empty-state">Historia jest pusta</p>
                    </div>
                </div>
            </div>

            <!-- Tags Tab -->
            <div id="tagsTab" class="tab-content" style="display: none;">
                <div class="tags-section glass-card">
                    <h3>ZarzƒÖdzanie tagami</h3>
                    <div class="tag-input-group">
                        <input type="text" id="newTagInput" placeholder="Nowy tag...">
                        <input type="color" id="newTagColor" value="#6366f1">
                        <button onclick="window.app.addNewTag()">
                            <i class="fas fa-plus"></i> Dodaj
                        </button>
                    </div>
                    <div id="tagsList" class="tags-list">
                        <p class="empty-state">Brak tag√≥w</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- YouTube Mode -->
        <div id="youtubeMode" class="mode-container" style="display: none;">
            <div class="mode-header">
                <button class="back-button" onclick="window.app.showMainMenu()">
                    <i class="fas fa-arrow-left"></i> Powr√≥t
                </button>
                <h2><i class="fab fa-youtube"></i> YouTube</h2>
            </div>

            <div class="youtube-tabs">
                <button class="tab active" onclick="window.app.showYouTubeTab('search', event)">
                    <i class="fas fa-search"></i> Wyszukaj
                </button>
                <button class="tab" onclick="window.app.showYouTubeTab('favorites', event)">
                    <i class="fas fa-star"></i> Ulubione
                </button>
                <button class="tab" onclick="window.app.showYouTubeTab('history', event)">
                    <i class="fas fa-history"></i> Historia
                </button>
                <button class="tab" onclick="window.app.showYouTubeTab('plan', event)">
                    <i class="fas fa-calendar-plus"></i> Zaplanuj
                </button>
                <button class="tab" onclick="window.app.showYouTubeTab('playlists', event)">
                    <i class="fas fa-list"></i> Playlisty
                </button>
            </div>

            <!-- Search Tab -->
            <div id="searchTab" class="tab-content active">
                <div class="search-section glass-card">
                    <div class="search-type-selector">
                        <button class="search-type active" data-type="video" onclick="window.app.setSearchType(this)">
                            <i class="fas fa-video"></i> Filmy
                        </button>
                        <button class="search-type" data-type="channel" onclick="window.app.setSearchType(this)">
                            <i class="fas fa-tv"></i> Kana≈Çy
                        </button>
                        <button class="search-type" data-type="playlist" onclick="window.app.setSearchType(this)">
                            <i class="fas fa-list"></i> Playlisty
                        </button>
                    </div>

                    <div class="search-input-group">
                        <input type="text" id="youtubeSearch" placeholder="Czego szukasz?" class="search-input" onkeypress="if(event.key==='Enter'){window.app.searchYouTube()}">
                        <button class="search-button" onclick="window.app.searchYouTube()">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>

                    <div class="search-status-yt" id="youtubeSearchStatus" style="display: none;">
                        <div class="search-spinner"></div>
                        <span>Wyszukiwanie YouTube TimerHub...</span>
                    </div>

                    <div id="searchResults" class="search-results"></div>
                </div>
            </div>

            <!-- Favorites Tab -->
            <div id="favoritesTabYT" class="tab-content" style="display: none;">
                <div class="favorites-section glass-card">
                    <div class="favorites-header">
                        <h3>Ulubione kana≈Çy</h3>
                        <button class="add-favorite-btn gradient-btn" onclick="window.app.showAddFavorite()">
                            <i class="fas fa-plus-circle"></i> 
                            <span>Dodaj kana≈Ç</span>
                        </button>
                    </div>
                    <div id="favoriteChannelsList" class="channels-grid">
                        <p class="empty-state">Brak ulubionych kana≈Ç√≥w</p>
                    </div>
                </div>
            </div>

            <!-- History Tab -->
            <div id="historyTabYT" class="tab-content" style="display: none;">
                <div class="history-section glass-card">
                    <div class="history-header">
                        <h3>Historia oglƒÖdania</h3>
                        <button class="clear-history-btn" onclick="window.app.clearHistory()">
                            <i class="fas fa-trash"></i> Wyczy≈õƒá
                        </button>
                    </div>
                    <div id="watchHistory" class="history-list">
                        <p class="empty-state">Historia jest pusta</p>
                    </div>
                </div>
            </div>

            <!-- Plan Tab -->
            <div id="planTab" class="tab-content" style="display: none;">
                <div class="plan-section glass-card">
                    <h3>Zaplanuj oglƒÖdanie</h3>
                    <form id="youtubeForm" onsubmit="window.app.handleYouTubeSubmit(event)">
                        <div class="form-group">
                            <label for="videoUrl">
                                <i class="fas fa-link"></i> Link do filmu
                            </label>
                            <input type="url" id="videoUrl" placeholder="https://www.youtube.com/watch?v=..." required>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="videoDate">
                                    <i class="fas fa-calendar"></i> Data
                                </label>
                                <input type="date" id="videoDate" required>
                            </div>
                            <div class="form-group">
                                <label for="videoTime">
                                    <i class="fas fa-clock"></i> Godzina
                                </label>
                                <input type="time" id="videoTime" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="videoDuration">
                                <i class="fas fa-hourglass"></i> Czas oglƒÖdania (minuty)
                            </label>
                            <input type="number" id="videoDuration" value="30" min="1" required>
                        </div>

                        <button type="submit" class="submit-button">
                            <i class="fas fa-play"></i> Rozpocznij odliczanie
                        </button>
                    </form>
                </div>
            </div>

            <!-- Playlists Tab -->
            <div id="playlistsTab" class="tab-content" style="display: none;">
                <div class="playlists-section glass-card">
                    <div class="playlists-header">
                        <h3>Moje playlisty</h3>
                        <button class="add-playlist-btn gradient-btn" onclick="window.app.createPlaylist()">
                            <i class="fas fa-plus-circle"></i> Nowa playlista
                        </button>
                    </div>
                    <div id="playlistsList" class="playlists-container">
                        <p class="empty-state">Brak playlist</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Timer Display -->
        <div id="timerDisplay" class="timer-display" style="display: none;">
            <div class="timer-content">
                <button class="close-timer" onclick="window.app.closeTimer()">
                    <i class="fas fa-times"></i>
                </button>
                
                <div class="timer-info">
                    <div class="timer-icon" id="timerIcon">
                        <i class="fas fa-users"></i>
                    </div>
                    <h2 id="timerTitle">Spotkanie Teams</h2>
                    <p id="timerSubtitle">Rozpoczƒôcie za...</p>
                </div>

                <div class="timer-countdown" id="timerCountdown">
                    <div class="time-unit">
                        <span class="time-value" id="days">00</span>
                        <span class="time-label">Dni</span>
                    </div>
                    <div class="time-unit">
                        <span class="time-value" id="hours">00</span>
                        <span class="time-label">Godziny</span>
                    </div>
                    <div class="time-unit">
                        <span class="time-value" id="minutes">00</span>
                        <span class="time-label">Minuty</span>
                    </div>
                    <div class="time-unit">
                        <span class="time-value" id="seconds">00</span>
                        <span class="time-label">Sekundy</span>
                    </div>
                </div>

                <div class="timer-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-info">
                        <span id="progressStart">--:--</span>
                        <span id="progressEnd">--:--</span>
                    </div>
                </div>

                <div class="timer-actions">
                    <button class="timer-action-btn" onclick="window.app.openNotesForTimer()">
                        <i class="fas fa-sticky-note"></i> Notatki
                    </button>
                    <button class="timer-action-btn" id="pauseBtn" onclick="window.app.togglePause()">
                        <i class="fas fa-pause"></i> Pauza
                    </button>
                    <button class="timer-action-btn danger" onclick="window.app.stopTimer()">
                        <i class="fas fa-stop"></i> Zatrzymaj
                    </button>
                </div>
            </div>
        </div>

        <!-- Active Timer Notification -->
        <div id="activeTimerNotification" class="active-timer-notification" style="display: none;">
            <div class="notification-content">
                <i class="fas fa-clock"></i>
                <span id="activeTimerText">Aktywne odliczanie</span>
                <button onclick="window.app.showTimer()">Otw√≥rz</button>
            </div>
        </div>

        <!-- Pomodoro Timer -->
        <div id="pomodoroTimer" class="pomodoro-timer" style="display: none;">
            <div class="pomodoro-content">
                <h3>Tryb Pomodoro</h3>
                <div class="pomodoro-display">
                    <span id="pomodoroMinutes">25</span>:<span id="pomodoroSeconds">00</span>
                </div>
                <div class="pomodoro-status" id="pomodoroStatus">Czas pracy</div>
                <div class="pomodoro-actions">
                    <button onclick="window.app.togglePomodoroPause()">
                        <i class="fas fa-pause"></i>
                    </button>
                    <button onclick="window.app.skipPomodoroSession()">
                        <i class="fas fa-forward"></i>
                    </button>
                    <button onclick="window.app.stopPomodoro()">
                        <i class="fas fa-stop"></i>
                    </button>
                </div>
                <div class="pomodoro-stats">
                    Sesje: <span id="pomodoroSessions">0</span>
                </div>
            </div>
        </div>

        <!-- Notifications container -->
        <div id="notifications" class="notifications"></div>
    </div>

    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { 
            getAuth, 
            signInAnonymously, 
            onAuthStateChanged 
        } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { 
            getDatabase, 
            ref, 
            set, 
            get, 
            push, 
            onValue, 
            onDisconnect, 
            serverTimestamp,
            remove,
            update,
            query,
            orderByChild,
            limitToLast
        } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        const firebaseConfig = {
            apiKey: "AIzaSyBIUs_PIGG3G5EJGblkBEP2sTIHZq5Kpvs",
            authDomain: "timerhub-5fe38.firebaseapp.com",
            databaseURL: "https://timerhub-5fe38-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "timerhub-5fe38",
            storageBucket: "timerhub-5fe38.appspot.com",
            messagingSenderId: "630173406824",
            appId: "1:630173406824:web:3b88c00d0e32b40e2e7d65",
            measurementId: "G-L9BQ5NCDPP"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);

        // Make Firebase services available globally
        window.firebase = {
            auth,
            database,
            ref,
            set,
            get,
            push,
            onValue,
            onDisconnect,
            serverTimestamp,
            remove,
            update,
            query,
            orderByChild,
            limitToLast,
            signInAnonymously,
            onAuthStateChanged
        };
    </script>

    <!-- Main Application Script -->
    <script src="script.js"></script>

    <!-- Google Sign In Script with async loading -->
    <script>
        // Load Google Sign-In library
        function loadGoogleSignIn() {
            // Check if Google library already loaded
            if (window.google && window.google.accounts) {
                initializeGoogleSignIn();
                return;
            }
            
            // Create script element
            const script = document.createElement('script');
            script.src = 'https://accounts.google.com/gsi/client';
            script.async = true;
            script.defer = true;
            
            script.onload = function() {
                console.log('Google Sign-In library loaded');
                initializeGoogleSignIn();
            };
            
            script.onerror = function() {
                console.error('Failed to load Google Sign-In library');
                showGoogleSignInError();
            };
            
            document.head.appendChild(script);
        }
        
        // Initialize Google Sign-In
        function initializeGoogleSignIn() {
            try {
                google.accounts.id.initialize({
                    client_id: '630173406824-ada5j713qsm99do8e98fvbiiq61j59dj.apps.googleusercontent.com',
                    callback: handleCredentialResponse,
                    auto_select: false,
                    cancel_on_tap_outside: true
                });
                
                google.accounts.id.renderButton(
                    document.getElementById("googleSignInButton"),
                    { 
                        theme: "filled_blue",
                        size: "large",
                        text: "signin_with",
                        shape: "rectangular",
                        logo_alignment: "left",
                        width: 280
                    }
                );
                
                // Check for stored credential
                google.accounts.id.prompt((notification) => {
                    if (notification.isNotDisplayed() || notification.isSkippedMoment()) {
                        console.log('Google Sign In not displayed or skipped');
                    }
                });
            } catch (error) {
                console.error('Error initializing Google Sign-In:', error);
                showGoogleSignInError();
            }
        }
        
        // Handle Google Sign-In response
        function handleCredentialResponse(response) {
            try {
                const responsePayload = decodeJwtResponse(response.credential);
                console.log('User logged in:', responsePayload.email);
                
                if (window.app) {
                    window.app.handleGoogleLogin(responsePayload, response.credential);
                } else {
                    // Save for later processing
                    localStorage.setItem('pendingGoogleLogin', JSON.stringify({
                        userInfo: responsePayload,
                        credential: response.credential
                    }));
                    location.reload();
                }
            } catch (error) {
                console.error('Error handling login:', error);
                alert('B≈ÇƒÖd logowania. Spr√≥buj ponownie.');
            }
        }
        
        function decodeJwtResponse(token) {
            const base64Url = token.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
            return JSON.parse(jsonPayload);
        }
        
        function showGoogleSignInError() {
            const buttonContainer = document.getElementById("googleSignInButton");
            if (buttonContainer) {
                buttonContainer.innerHTML = `
                    <div style="text-align: center;">
                        <p style="color: #f59e0b; margin-bottom: 15px;">
                            <i class="fas fa-exclamation-triangle"></i> 
                            Problem z Google Sign-In
                        </p>
                        <p style="color: var(--text-secondary); font-size: 0.9rem;">
                            Od≈õwie≈º stronƒô i spr√≥buj ponownie
                        </p>
                    </div>
                `;
            }
        }
        
        // Start loading
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadGoogleSignIn);
        } else {
            loadGoogleSignIn();
        }
    </script>
</body>
</html>